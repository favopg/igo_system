<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>JSONデータをテーブルに表示</title>
	<!-- BootstrapのCSSをCDNから読み込み -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
	<div class="container mt-5">
		<h1 id = "header">対局一覧</h1>
		<table class="table table-striped table-bordered">
			<thead class="table-primary">
				<tr>
					<th>ID</th>
					<th>黒番</th>
					<th>白番</th>
					<th>結果</th>
					<th>棋譜</th>
					<th>対局日</th>
				</tr>
			</thead>
			<tbody id="table-body">
				<!-- JSONデータがここに挿入されます -->
			</tbody>
		</table>
	</div>

	<!-- JavaScript -->
	<script>

		document.addEventListener('DOMContentLoaded', function () {
			fetch('igo_system')
				.then(response => {
					if (!response.ok) {
						throw new Error('HTTP error ' + response.status);
					}
					return response.json();
				})
				.then(data => {
					// 1件対応
					/**
					var responseJson = JSON.stringify(data, null, 2);
					console.log(data);
					const tableBody = document.getElementById("table-body");
					const tr = document.createElement("tr"); // 新しい行を作成
					tr.innerHTML = `
						<td>${data.id}</td>
						<td>${data.name}</td>
						<td>${data.email}</td>
						<td>${data.created_at}</td>
					`;
					tableBody.appendChild(tr); // 行をtbodyに追加
					*/

					// 複数件対応
					const tableBody = document.getElementById("table-body");
					var responseJson = JSON.stringify(data, null, 2);
					const parsedData = JSON.parse(responseJson);
					
					const h1 = document.getElementById("header");
					
					const dynamicHtml = `<h3>通算成績：黒${parsedData.black_victory_cnt}&nbsp;白${parsedData.white_victory_cnt} </h3>`;
					
					h1.outerHTML += dynamicHtml;

					parsedData.records.forEach(row => {
						const tr = document.createElement("tr");
						tr.innerHTML = `
					                <td>${row.id}</td>
					                <td>${row.black_name}</td>
					                <td>${row.white_name}</td>
					                <td>${row.result}</td>
									<td><a href="${row.result_link}" target="_black">つぶや棋譜</td>
									<td>${row.match_at}</td>
					            `;
						tableBody.appendChild(tr);
					});
				})
				.catch(error => {
					console.error('エラー:', error);
				});
		});		
	</script>
</body>

</html>