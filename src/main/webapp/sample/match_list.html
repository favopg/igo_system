<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>囲碁対戦管理ダッシュボード</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
        }

        @media (max-width: 767.98px) {
            .sidebar {
                top: 5rem;
            }
        }

        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: .5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
    </style>
</head>

<body>
<div id="app" class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="#">
                            <i class="bi bi-table me-2"></i>
                            対戦一覧
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="register.html">
                            <i class="bi bi-plus-square me-2"></i>
                            対戦登録
                        </a>
                    </li>
                </ul>
                <div class="border-top my-3"></div>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#">
                            <i class="bi bi-box-arrow-right me-2"></i>
                            ログアウト
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

            <!-- Header -->
            <div class="bg-info text-white p-2 mb-4">
                <h2 class="h4 mb-0">対戦一覧</h2>
            </div>

            <!-- Total Score -->
            <div class="table-responsive mb-4">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th colspan="3" class="text-center bg-light">通算対戦成績</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><strong>黒勝利数:</strong> {{ apiResponse.black_victory_cnt}}勝</td>
                        <td><strong>白勝利数:</strong> {{ apiResponse.white_victory_cnt }}勝</td>
                        <!--
                        <td><strong>勝率:</strong> {{ winRate }}%</td>
                        -->
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Game List -->
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>編集</th>
                        <th>黒番</th>
                        <th>白番</th>
                        <th>結果</th>
                        <th>棋譜</th>
                        <th>対局日</th>
                        <th>コメント</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="game in matches.records" :key="game.id">
                        <td>{{ game.id }}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                        <td>{{ game.black_name }}</td>
                        <td>{{ game.white_name }}</td>
                        <td>{{ game.result }}</td>
                        <td>
                            <a :href="game.result_link" target="_blank">棋譜を見る</a>
                        </td>
                        <td>{{ game.match_at }}</td>
                        <td>{{ game.comment }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" :class="{ disabled: currentPage === 1 }">
                        <a class="page-link" href="#" @click.prevent="changePage(currentPage - 1)">前へ</a>
                    </li>
                    <li v-for="page in totalPages" :key="page" class="page-item"
                        :class="{ active: currentPage === page }">
                        <a class="page-link" href="#" @click.prevent="changePage(page)">{{ page }}</a>
                    </li>
                    <li class="page-item" :class="{ disabled: currentPage === totalPages }">
                        <a class="page-link" href="#" @click.prevent="changePage(currentPage + 1)">次へ</a>
                    </li>
                </ul>
            </nav>
            -->
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.prod.js"></script>
<script>
    const { createApp, ref, computed } = Vue

    createApp({
        setup() {
            var matches = ref([
                {records:[]}
            ])
            var apiResponse = ref(0)

            /**
             const itemsPerPage = 10
             const currentPage = ref(1)

             const totalPages = computed(() => Math.ceil(games.value.length / itemsPerPage))

             const paginatedGames = computed(() => {
             const start = (currentPage.value - 1) * itemsPerPage
             const end = start + itemsPerPage
             return games.value.slice(start, end)
             })

             const changePage = (page) => {
             if (page >= 1 && page <= totalPages.value) {
             currentPage.value = page
             }
             }

             const totalWins = computed(() => games.value.filter(game => game.result === "黒勝").length)
             const totalLosses = computed(() => games.value.filter(game => game.result === "白勝").length)
             const winRate = computed(() => {
             const total = totalWins.value + totalLosses.value
             return total > 0 ? ((totalWins.value / total) * 100).toFixed(2) : 0
             })
             */

            return {
                matches,
                apiResponse
                /**
                 currentPage,
                 totalPages,
                 paginatedGames,
                 changePage,
                 totalWins,
                 totalLosses,
                 winRate
                 */
            }
        },
        methods: {
            selectMatches() {
                fetch("igo_system")
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('HTTP error ' + response.status);
                        }
                        return response.json();
                    })
                    .then(data => {
                        const responseJson = JSON.stringify(data, null, 2);
                        const parsedData = JSON.parse(responseJson);
                        //console.log(parsedData);
                        this.matches.records = parsedData.records;
                        console.log("配列の値" + JSON.stringify( this.matches.records, null, 2));
                        this.apiResponse = parsedData;
                    })
                    .catch(error => {
                        console.error("データ取得に失敗しました")
                    });

            },

        },
        mounted() {
            this.selectMatches();
        }
    }).mount('#app')
</script>
</body>

</html>